const fichesData = {
  fiches: {
    '1A': {
      '1': {
        'Maths': [
          { titre: 'Calculs de base', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' },
          { titre: 'Fonctions usuelles', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Physique': [
          { titre: 'Cinématique', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '2': {
        'Info': [
          { titre: 'Algorithmes', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Chimie': [
          { titre: 'Réactions chimiques', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
    '2A': {
      '3': {
        'Mécanique': [
          { titre: 'Résistance des matériaux', visionner: 'https://drive.google.com/file/d/19i65g06_nhSZx5naNHAza6lH6VwfBbN2/preview', telecharger: 'https://drive.google.com/uc?export=download&id=19i65g06_nhSZx5naNHAza6lH6VwfBbN2' }
        ],
        'Maths': [
          { titre: 'Intégrales', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '4': {
        'Électrotechnique': [
          { titre: 'Circuits RLC', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Informatique': [
          { titre: 'Structures de données', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
    '3A': {
      '5': {
        'Électronique': [
          { titre: 'Transistors', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Thermodynamique': [
          { titre: 'Cycles thermodynamiques', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '6': {
        'Management': [
          { titre: 'Gestion de projet', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Innovation': [
          { titre: 'Méthodes créatives', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
    '4A': {
      '7': {
        'Maths': [
          { titre: 'Calculs de base', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' },
          { titre: 'Fonctions usuelles', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Physique': [
          { titre: 'Cinématique', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '8': {
        'Info': [
          { titre: 'Algorithmes', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Chimie': [
          { titre: 'Réactions chimiques', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
    '5A': {
      '9': {
        'Maths': [
          { titre: 'Calculs de base', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' },
          { titre: 'Fonctions usuelles', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Physique': [
          { titre: 'Cinématique', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '10': {
        'Info': [
          { titre: 'Algorithmes', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Chimie': [
          { titre: 'Réactions chimiques', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
  },

  annales: {
    '1A': {
      '1': {
        'Maths': [
          { titre: 'Annale 2023', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '2': {
        'Maths': [
          { titre: 'Annale 2023', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
    '2A': {
      '3': {
        'Électrotechnique': [
          { titre: 'Sujet RLC', visionner: 'https://drive.google.com/file/d/1gAn6hkQWSX2rBx6z1rYZF2oJ4zQe8ItF/preview', telecharger: 'https://drive.google.com/uc?export=download&id=1gAn6hkQWSX2rBx6z1rYZF2oJ4zQe8ItF' }
        ]
      },
      '4': {
        'Maths': [
          { titre: 'Annale 2023', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
    '3A': {
      '5': {
        'Thermodynamique': [
          { titre: 'Annale 2022', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Management': [
          { titre: 'Sujet type QCM', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '6': {
        'Maths': [
          { titre: 'Annale 2023', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
    '4A': {
      '7': {
        'Thermodynamique': [
          { titre: 'Annale 2022', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Management': [
          { titre: 'Sujet type QCM', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '8': {
        'Maths': [
          { titre: 'Annale 2023', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
    '5A': {
      '9': {
        'Thermodynamique': [
          { titre: 'Annale 2022', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Management': [
          { titre: 'Sujet type QCM', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '10': {
        'Maths': [
          { titre: 'Annale 2023', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    }
  },
  cours: {
    '1A': {
      '1': {
        'Maths': [
          { titre: 'Calculs de base', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' },
          { titre: 'Fonctions usuelles', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Physique': [
          { titre: 'Cinématique', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '2': {
        'Info': [
          { titre: 'Algorithmes', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Chimie': [
          { titre: 'Réactions chimiques', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
    '2A': {
      '3': {
        'Mécanique': [
          { titre: 'Résistance des matériaux', visionner: 'https://drive.google.com/file/d/19i65g06_nhSZx5naNHAza6lH6VwfBbN2/preview', telecharger: 'https://drive.google.com/uc?export=download&id=19i65g06_nhSZx5naNHAza6lH6VwfBbN2' }
        ],
        'Maths': [
          { titre: 'Intégrales', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '4': {
        'Électrotechnique': [
          { titre: 'Circuits RLC', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Informatique': [
          { titre: 'Structures de données', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
    '3A': {
      '5': {
        'Électronique': [
          { titre: 'Transistors', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Thermodynamique': [
          { titre: 'Cycles thermodynamiques', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '6': {
        'Management': [
          { titre: 'Gestion de projet', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Innovation': [
          { titre: 'Méthodes créatives', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
    '4A': {
      '7': {
        'Maths': [
          { titre: 'Calculs de base', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' },
          { titre: 'Fonctions usuelles', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Physique': [
          { titre: 'Cinématique', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '8': {
        'Info': [
          { titre: 'Algorithmes', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Chimie': [
          { titre: 'Réactions chimiques', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
    '5A': {
      '9': {
        'Maths': [
          { titre: 'Calculs de base', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' },
          { titre: 'Fonctions usuelles', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Physique': [
          { titre: 'Cinématique', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      },
      '10': {
        'Info': [
          { titre: 'Algorithmes', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ],
        'Chimie': [
          { titre: 'Réactions chimiques', visionner: 'mettez votre lien', telecharger: 'mettez votre lien' }
        ]
      }
    },
  }
};


let currentType = '';

function updateAnnee() {
  const typeSelect = document.getElementById("type");
  const anneeSelect = document.getElementById("annee");
  const semestreSelect = document.getElementById("semestre");
  const matiereSelect = document.getElementById("matiere");
  const container = document.getElementById("fiche-container");

  currentType = typeSelect.value;
  anneeSelect.innerHTML = '<option value="">-- Choisir une année --</option>';
  semestreSelect.innerHTML = '<option value="">-- Choisir un semestre --</option>';
  matiereSelect.innerHTML = '<option value="">-- Choisir une matière --</option>';
  container.innerHTML = '';

  semestreSelect.disabled = true;
  matiereSelect.disabled = true;

  const allAnnees = new Set();

  ['fiches', 'annales', 'cours'].forEach(type => {
    if (fichesData[type]) {
      Object.keys(fichesData[type]).forEach(annee => {
        allAnnees.add(annee);
      });
    }
  });

  allAnnees.forEach(annee => {
    anneeSelect.innerHTML += `<option value="${annee}">${annee}</option>`;
  });

  anneeSelect.disabled = allAnnees.size === 0;
}


function updateSemestres() {
  const annee = document.getElementById("annee").value;
  const semestreSelect = document.getElementById("semestre");
  const matiereSelect = document.getElementById("matiere");
  const container = document.getElementById("fiche-container");

  semestreSelect.innerHTML = '<option value="">-- Choisir un semestre --</option>';
  matiereSelect.innerHTML = '<option value="">-- Choisir une matière --</option>';
  container.innerHTML = '';
  semestreSelect.disabled = true;
  matiereSelect.disabled = true;

  if (!annee) return;

  const semestres = new Set();
  ['fiches', 'annales', 'cours'].forEach(type => {
    if (fichesData[type] && fichesData[type][annee]) {
      Object.keys(fichesData[type][annee]).forEach(sem => {
        semestres.add(sem);
      });
    }
  });

  semestres.forEach(sem => {
    semestreSelect.innerHTML += `<option value="${sem}">Semestre ${sem}</option>`;
  });

  if (semestres.size > 0) semestreSelect.disabled = false;
}

function updateMatieres() {
  const annee = document.getElementById("annee").value;
  const semestre = document.getElementById("semestre").value;
  const matiereSelect = document.getElementById("matiere");
  const container = document.getElementById("fiche-container");

  matiereSelect.innerHTML = '<option value="">-- Choisir une matière --</option>';
  container.innerHTML = '';
  matiereSelect.disabled = true;

  if (annee && semestre) {
    const typesToSearch = ['fiches', 'annales', 'cours'];
    const matieresSet = new Set();

    typesToSearch.forEach(type => {
      if (fichesData[type] && fichesData[type][annee] && fichesData[type][annee][semestre]) {
        Object.keys(fichesData[type][annee][semestre]).forEach(mat => {
          matieresSet.add(mat);
        });
      }
    });

    matieresSet.forEach(mat => {
      matiereSelect.innerHTML += `<option value="${mat}">${mat}</option>`;
    });

    if (matieresSet.size > 0) {
      matiereSelect.disabled = false;
    }
  }
}


function updateFiches() {
  const annee = document.getElementById("annee").value;
  const semestre = document.getElementById("semestre").value;
  const matiere = document.getElementById("matiere").value;
  const selectedType = document.getElementById("type").value;
  const container = document.getElementById("fiche-container");

  container.innerHTML = '';

  const typesToSearch = selectedType ? [selectedType] : ['fiches', 'annales', 'cours'];

  typesToSearch.forEach(type => {
    if (
      fichesData[type] &&
      fichesData[type][annee] &&
      fichesData[type][annee][semestre] &&
      fichesData[type][annee][semestre][matiere]
    ) {
      fichesData[type][annee][semestre][matiere].forEach(fiche => {
        container.innerHTML += `
          <div class="fiche-card">
            <h3>📄 ${fiche.titre}</h3>
            <div class="fiche-buttons">
              <button class="btn" onclick="visionnerEnLigne('${fiche.visionner}')">👁️ Visionner</button>
              <a href="${fiche.telecharger}" class="btn">⬇️ Télécharger</a>
            </div>
          </div>`;
      });
    }
  });
}


function visionnerEnLigne(url) {
  let iframe = document.getElementById('pdfViewer');
  if (!iframe) {
    iframe = document.createElement('iframe');
    iframe.id = 'pdfViewer';
    iframe.style.display = 'block';
    iframe.style.width = '100%';
    iframe.style.height = '600px';
    iframe.style.marginTop = '1rem';
    document.querySelector(".container").appendChild(iframe);
  }
  iframe.src = url;
  iframe.scrollIntoView({ behavior: 'smooth' });
}
window.onload = function() {
  updateAnnee();
};
